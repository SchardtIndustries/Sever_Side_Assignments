-- ============================
-- SUPPLY_CHAIN Assignment
-- ============================

DROP DATABASE IF EXISTS SUPPLY_CHAIN;
CREATE DATABASE SUPPLY_CHAIN;
USE SUPPLY_CHAIN;

-- SUPPLIER
CREATE TABLE SUPPLIER (
  SUPNR       CHAR(4)      NOT NULL,
  SUPNAME     VARCHAR(40)  NOT NULL,
  SUPADDRESS  VARCHAR(50),
  SUPCITY     VARCHAR(20),
  SUPSTATUS   SMALLINT,
  SUPCATEGORY VARCHAR(10) DEFAULT 'SILVER',
  PRIMARY KEY (SUPNR),
  CONSTRAINT chk_supplier_status CHECK (SUPSTATUS BETWEEN 0 AND 100)
);

-- PRODUCT
CREATE TABLE PRODUCT (
  PRODNR             CHAR(6)     NOT NULL,
  PRODNAME           VARCHAR(60) NOT NULL,
  PRODTYPE           VARCHAR(10),
  AVAILABLE_QUANTITY INTEGER,
  PRODIMAGE          BLOB,
  PRIMARY KEY (PRODNR),
  UNIQUE (PRODNAME),
  CONSTRAINT chk_product_type
    CHECK (PRODTYPE IN ('white', 'red', 'rose', 'sparkling'))
);

-- SUPPLIES
CREATE TABLE SUPPLIES (
  SUPNR          CHAR(4) NOT NULL,
  PRODNR         CHAR(6) NOT NULL,
  PURCHASE_PRICE DECIMAL(8,2),
  DELIV_PERIOD   TIME,
  PRIMARY KEY (SUPNR, PRODNR),
  FOREIGN KEY (SUPNR) REFERENCES SUPPLIER(SUPNR)
    ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (PRODNR) REFERENCES PRODUCT(PRODNR)
    ON DELETE CASCADE ON UPDATE CASCADE
);

-- PURCHASE_ORDER
CREATE TABLE PURCHASE_ORDER (
  PONR   CHAR(7) NOT NULL,
  PODATE DATE,
  SUPNR  CHAR(4) NOT NULL,
  PRIMARY KEY (PONR),
  FOREIGN KEY (SUPNR) REFERENCES SUPPLIER(SUPNR)
    ON DELETE CASCADE ON UPDATE CASCADE
);

-- PO_LINE
CREATE TABLE PO_LINE (
  PONR     CHAR(7) NOT NULL,
  PRODNR   CHAR(6) NOT NULL,
  QUANTITY INTEGER,
  PRIMARY KEY (PONR, PRODNR),
  FOREIGN KEY (PONR) REFERENCES PURCHASE_ORDER(PONR)
    ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (PRODNR) REFERENCES PRODUCT(PRODNR)
    ON DELETE CASCADE ON UPDATE CASCADE
);

-- ============================
-- INSERT DATA
-- ============================

INSERT INTO SUPPLIER VALUES
('S001','Rhine Valley Imports','12 River Rd','Cologne',85,'GOLD'),
('S002','Bordeaux Cellars Ltd','8 Rue du Vin','Bordeaux',72,'SILVER'),
('S003','Tuscan Grapes Co','55 Via Roma','Florence',64,'SILVER'),
('S004','Cava Spark Supply','19 Plaza Real','Barcelona',90,'PLATINUM'),
('S005','Napa Select Partners','400 Oak St','Napa',55,'SILVER');

INSERT INTO PRODUCT VALUES
('P00001','Chardonnay Reserve 2022','white',120,NULL),
('P00002','Cabernet Sauvignon 2021','red',80,NULL),
('P00003','Provence Rosé 2023','rose',150,NULL),
('P00004','Brut Sparkling Cuvée NV','sparkling',60,NULL),
('P00005','Pinot Noir Single Vineyard','red',45,NULL);

INSERT INTO SUPPLIES VALUES
('S001','P00001',9.50,'72:00:00'),
('S002','P00002',14.25,'96:00:00'),
('S003','P00003',7.80,'48:00:00'),
('S004','P00004',11.10,'72:00:00'),
('S005','P00005',16.90,'120:00:00');

INSERT INTO PURCHASE_ORDER VALUES
('PO10001','2026-01-02','S001'),
('PO10002','2026-01-02','S002'),
('PO10003','2026-01-03','S003'),
('PO10004','2026-01-03','S004'),
('PO10005','2026-01-04','S005');

INSERT INTO PO_LINE VALUES
('PO10001','P00001',30),
('PO10002','P00002',20),
('PO10003','P00003',40),
('PO10004','P00004',25),
('PO10005','P00005',15);

-- ============================
-- UPDATES
-- ============================

UPDATE SUPPLIER
SET SUPSTATUS = 95, SUPCATEGORY='PLATINUM'
WHERE SUPNR='S003';

UPDATE PRODUCT
SET AVAILABLE_QUANTITY = AVAILABLE_QUANTITY + 25
WHERE PRODNR='P00004';

-- ============================
-- DELETE (CASCADE DEMO)
-- ============================

DELETE FROM PURCHASE_ORDER
WHERE PONR='PO10002';
